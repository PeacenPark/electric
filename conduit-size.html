<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>전선관 계산기</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f6f9fc; padding: 20px; margin: 0; }
    .container {
      max-width: 860px;
      margin: auto;
      background: #fff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      position: relative;
    }
    h1 {
      text-align: center;
      color: #1a73e8;
      margin-bottom: 30px;
    }
    .field-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
      align-items: center;
    }
    .field {
      flex: 1;
      min-width: 130px;
    }
    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }
    select, input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      background: #1a73e8;
      color: #fff;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
      margin-top: 10px;
      margin-right: 5px;
    }
    button:hover { background: #155ec2; }
    .remove-btn {
      background: #e74c3c;
      margin-left: 10px;
    }
    .remove-btn:hover {
      background: #c0392b;
    }
    #result {
      margin-top: 20px;
      background: #e8f0fe;
      padding: 15px;
      border-radius: 10px;
      font-weight: bold;
    }
    .group {
      background: #fafafa;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
      position: relative;
    }
    .red {
      color: red;
      font-weight: bold;
    }
    .home-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      background: #1a73e8;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      z-index: 1000;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .home-btn:hover {
      background: #155ec2;
    }
  </style>
</head>
<body>
  <div class="container">
    <button class="home-btn" onclick="goBack()">← 홈으로</button>
    <h1>전선관 계산기</h1>
    <label>전선관 종류</label>
    <select id="pipeType">
      <option value="ELP">ELP관</option>
      <option value="CD">CD관</option>
      <option value="PE">PE관</option>
      <option value="HI">HI관</option>
      <option value="G">금속관 G형</option>
      <option value="C">금속관 C형</option>
      <option value="TRAY">케이블 트레이</option>
    </select>

    <div id="cableGroups"></div>
    <button onclick="addCableGroup()">+ 전선 추가</button>
    <button onclick="calculate()">계산하기</button>

    <div id="result"></div>
  </div>

<script>
  function goBack() {
    window.location.href = 'index.html';
  }

  const cableDiameters = {
    'CV': {
      '1.5': { '1': 6.3, '2': 11.0, '3': 12.1, '4': 13.0 },
      '2.5': { '1': 6.7, '2': 12.0, '3': 13.2, '4': 14.0 },
      '4':   { '1': 7.2, '2': 13.0, '3': 14.5, '4': 15.5 },
      '6':   { '1': 7.8, '2': 14.0, '3': 15.8, '4': 17.0 },
      '10':  { '1': 9.4, '2': 17.0, '3': 19.0, '4': 20.5 },
      '16':  { '1': 10.0,'2': 19.0, '3': 21.5, '4': 23.0 },
      '25':  { '1': 11.5,'2': 22.0, '3': 25.0, '4': 26.5 },
      '35':  { '1': 13.0,'2': 24.5, '3': 28.0, '4': 30.0 },
      '50':  { '1': 15.0,'2': 28.0, '3': 32.0, '4': 34.5 },
      '70':  { '1': 17.0,'2': 32.0, '3': 36.5, '4': 39.5 },
      '95':  { '1': 19.5,'2': 36.5, '3': 42.0, '4': 45.5 },
      '120': { '1': 21.0,'2': 40.0, '3': 46.0, '4': 50.0 },
      '150': { '1': 23.5,'2': 44.0, '3': 50.5, '4': 55.0 },
      '185': { '1': 25.5,'2': 48.0, '3': 55.0, '4': 59.5 },
      '240': { '1': 28.5,'2': 53.5, '3': 61.5, '4': 66.5 },
      '300': { '1': 31.5,'2': 59.0, '3': 68.0, '4': 73.0 },
      '400': { '1': 35.0,'2': 65.0, '3': 75.0, '4': 80.0 },
      '500': { '1': 39.0,'2': 71.0, '3': 82.0, '4': 88.0 },
      '600': { '1': 42.0,'2': 76.0, '3': 88.0, '4': 94.0 }
    }
  };

  const elpConduits = [
    { name: '30mm', area: 600 },
    { name: '40mm', area: 1100 },
    { name: '50mm', area: 1700 },
    { name: '65mm', area: 2800 },
    { name: '80mm', area: 4200 },
    { name: '100mm', area: 6700 },
    { name: '125mm', area: 10500 },
    { name: '150mm', area: 15000 }
  ];

  const generalConduits = [
    { name: '22호', area: 300 },
    { name: '28호', area: 500 },
    { name: '36호', area: 800 },
    { name: '42호', area: 1200 },
    { name: '54호', area: 1500 },
    { name: '70호', area: 2500 }
  ];

  const trayWidths = [50, 100, 150, 200, 300, 400, 500, 600];
  let groupIndex = 0;

  function addCableGroup() {
    const div = document.createElement('div');
    div.className = 'group';
    div.setAttribute('id', `group${groupIndex}`);
    div.innerHTML = `
      <div class="field-group">
        <div class="field">
          <label>전선 굵기(㎟)</label>
          <select id="size${groupIndex}">
            <option value="">직접 입력</option>
            ${Object.keys(cableDiameters.CV).map(size => `<option value="${size}">${size}㎟</option>`).join('')}
          </select>
        </div>
        <div class="field">
          <label>Core 수</label>
          <select id="core${groupIndex}">
            <option value="1">1C</option>
            <option value="2">2C</option>
            <option value="3">3C</option>
            <option value="4">4C</option>
          </select>
        </div>
        <div class="field">
          <label>회로 수</label>
          <input type="number" id="count${groupIndex}" value="1" min="1">
        </div>
        <div class="field">
          <label>외경(mm)</label>
          <input type="number" step="0.1" id="customDia${groupIndex}" placeholder="자동 또는 수동 입력"
            oninput="document.getElementById('size${groupIndex}').value = '';">
        </div>
        <div class="field">
          <label>&nbsp;</label>
          <button class="remove-btn" onclick="removeCableGroup(${groupIndex})">삭제</button>
        </div>
      </div>`;
    document.getElementById('cableGroups').appendChild(div);
    groupIndex++;
  }

  function removeCableGroup(index) {
    const group = document.getElementById(`group${index}`);
    if (group) group.remove();
  }

  function calculate() {
    const pipeType = document.getElementById("pipeType").value;
    const conduitList = pipeType === 'ELP' ? elpConduits : generalConduits;
    const correction = pipeType === 'ELP' ? 0.7 :
                       pipeType === 'CD' ? 0.6 :
                       pipeType === 'PE' ? 0.6 :
                       pipeType === 'HI' ? 0.65 :
                       pipeType === 'G'  ? 0.8 :
                       pipeType === 'C'  ? 0.75 : 1.0;

    let totalArea = 0;
    let totalWidth = 0;
    let text = "";

    document.querySelectorAll(".group").forEach(groupDiv => {
      const id = groupDiv.id.replace("group", "");
      const size = document.getElementById(`size${id}`).value;
      const core = document.getElementById(`core${id}`).value;
      const count = parseInt(document.getElementById(`count${id}`).value) || 1;
      const customDia = parseFloat(document.getElementById(`customDia${id}`).value);
      let dia = customDia || (cableDiameters.CV[size]?.[core] || 0);
      if (!dia) return;

      const area = Math.PI * Math.pow(dia / 2, 2);
      totalArea += area * count;
      totalWidth += dia * count;

      const labelSize = size ? `${size}㎟` : `사용자 입력 (${dia}mm)`;
      text += `● ${labelSize} ${core}C × ${count}회로<br>`;
      text += `&nbsp;&nbsp;- 외경: ${dia}mm / 단면적: ${area.toFixed(2)}㎟ / 총: ${(area * count).toFixed(2)}㎟<br><br>`;
    });

    if (pipeType === "TRAY") {
      const tray = trayWidths.find(w => w >= totalWidth);
      const trayWidth = tray || trayWidths[trayWidths.length - 1];
      const fill = (totalWidth / trayWidth) * 100;
      text += `<strong>트레이 폭:</strong> ${trayWidth}mm / 케이블 총 폭: ${totalWidth.toFixed(1)}mm<br>`;
      text += `<strong>채움률:</strong> <span class="${fill > 50 ? 'red' : ''}">${fill.toFixed(1)}%</span>`;
    } else {
      const requiredArea = totalArea / (0.4 * correction);
      const match = conduitList.find(c => c.area >= requiredArea);

      if (match) {
        const fill = (totalArea / (match.area * correction)) * 100;
        text += `<strong>전선관:</strong> ${pipeType} ${match.name}<br>`;
        text += `<strong>내부 단면적:</strong> ${match.area}㎟<br>`;
        text += `<strong>채움률:</strong> ${fill.toFixed(1)}%`;
      } else {
        const largest = conduitList[conduitList.length - 1];
        const needed = Math.ceil(requiredArea / largest.area);
        const fill = (totalArea / (largest.area * correction * needed)) * 100;
        text += `<span class="red">※ 하나의 전선관으로 부족합니다.</span><br>`;
        text += `<strong>대안:</strong> ${pipeType} ${largest.name} × ${needed}개 사용<br>`;
        text += `<strong>채움률:</strong> ${fill.toFixed(1)}%`;
      }
    }

    text += `<br><br><small><strong>※ KEC 전선관 채움률 기준 안내</strong><br>
    - ELP관: 40% 권장<br>
    - CD관/PE관: 40% 이하<br>
    - HI관: 40~45% 이하<br>
    - 금속관(G/C형): 최대 50% 이하<br>
    - 케이블 트레이: 50% 이하 권장</small>`;

    document.getElementById("result").innerHTML = text;
  }

  addCableGroup();
</script>
</body>
</html>